<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Innerverse Chat - Signature Edition</title>
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            --glass: rgba(255, 255, 255, 0.05);
            --accent: #00d2ff;
            --me-gradient: linear-gradient(135deg, #00d2ff, #3a7bd5);
            --text: #f0f0f0;
        }

        body { 
            font-family: 'Inter', -apple-system, sans-serif; 
            background: var(--bg-gradient); 
            background-attachment: fixed;
            color: var(--text); 
            margin: 0; 
            display: flex; justify-content: center; align-items: center; 
            height: 100vh; 
        }

        #app-container { 
            width: 100%; max-width: 480px; height: 92vh; 
            background: var(--glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            display: flex; flex-direction: column; 
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* Login */
        #login-screen { 
            position: absolute; width: 100%; height: 100%; z-index: 20;
            background: #0f0c29; display: flex; flex-direction: column; 
            justify-content: center; align-items: center;
        }

        .btn-glow {
            background: var(--me-gradient); color: white; border: none;
            padding: 15px 30px; border-radius: 12px; font-weight: bold;
            cursor: pointer; box-shadow: 0 0 20px rgba(0, 210, 255, 0.4);
            transition: 0.3s;
        }

        /* Header */
        header {
            padding: 20px; background: rgba(0,0,0,0.2);
            display: flex; align-items: center; gap: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .avatar { width: 45px; height: 45px; border-radius: 14px; object-fit: cover; border: 2px solid var(--accent); }

        /* Chat Area */
        #messages { 
            flex: 1; padding: 20px; overflow-y: auto; 
            display: flex; flex-direction: column; gap: 15px; 
        }

        .msg-row { display: flex; gap: 10px; align-items: flex-end; }
        .msg-row.me { flex-direction: row-reverse; }

        .mini-avatar { width: 28px; height: 28px; border-radius: 8px; margin-bottom: 5px; }

        .bubble { 
            padding: 12px 16px; border-radius: 18px; max-width: 70%; 
            font-size: 14px; line-height: 1.5; position: relative;
            background: rgba(255,255,255,0.1);
        }

        .msg-row.me .bubble { 
            background: var(--me-gradient); 
            border-bottom-right-radius: 4px;
            color: white;
            box-shadow: 0 4px 15px rgba(0, 210, 255, 0.2);
        }

        .msg-row:not(.me) .bubble { 
            background: rgba(255,255,255,0.1); 
            border-bottom-left-radius: 4px; 
        }

        .sender-tag { font-size: 10px; color: var(--accent); margin-bottom: 4px; display: block; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }

        /* Input Area */
        #input-area { 
            padding: 20px; background: rgba(0,0,0,0.3);
            display: flex; gap: 12px;
        }

        input { 
            flex: 1; padding: 14px 20px; border-radius: 14px; border: none; 
            background: rgba(255,255,255,0.05); color: white; outline: none;
            border: 1px solid rgba(255,255,255,0.1);
        }

        #sendBtn { 
            background: var(--me-gradient); border: none; color: white; 
            border-radius: 14px; width: 50px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
        }
    </style>
</head>
<body>

<div id="app-container">
    <div id="login-screen">
        <h1 style="letter-spacing: 5px; font-weight: 900;">INNER<span style="color:var(--accent)">VERSE</span></h1>
        <button class="btn-glow" id="loginBtn">ACCESS DATABASE</button>
    </div>

    <div id="chat-screen" style="display:none; flex-direction:column; height:100%;">
        <header>
            <img id="myAvatar" class="avatar" src="">
            <div style="flex:1">
                <div id="myName" style="font-weight:bold; letter-spacing: 1px;"></div>
                <div style="font-size:10px; color:var(--accent)">● SECURE CONNECTION</div>
            </div>
            <button id="logoutBtn" style="background:none; border:none; color:#ff4b2b; cursor:pointer; font-size: 12px;">EXIT</button>
        </header>

        <div id="messages"></div>

        <div id="input-area">
            <input type="text" id="msgInput" placeholder="Kirim transmisi..." autocomplete="off">
            <button id="sendBtn">➤</button>
        </div>
    </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, push, onChildAdded, serverTimestamp, query, limitToLast } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
  import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  const firebaseConfig = {
  apiKey: "AIzaSyDGwFXEHRArBauIOksrGmCgbC1fpVLkfMk",
  authDomain: "globalchat-innerverse.firebaseapp.com",
  databaseURL: "https://globalchat-innerverse-default-rtdb.firebaseio.com",
  projectId: "globalchat-innerverse",
  storageBucket: "globalchat-innerverse.firebasestorage.app",
  messagingSenderId: "20520942010",
  appId: "1:20520942010:web:9d65b58ce00b2df9834583",
  measurementId: "G-ZFW3JJNGS5"
};

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();
  const chatRef = ref(db, 'chats');

  let currentUser = null;
  let initialized = false;

  document.getElementById('loginBtn').onclick = () => signInWithPopup(auth, provider);
  document.getElementById('logoutBtn').onclick = () => signOut(auth);

  onAuthStateChanged(auth, (user) => {
    if (user) {
      currentUser = user;
      document.getElementById('myName').textContent = user.displayName.toUpperCase();
      document.getElementById('myAvatar').src = user.photoURL;
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('chat-screen').style.display = 'flex';
      if(!initialized) { startChat(); initialized = true; }
    } else {
      document.getElementById('login-screen').style.display = 'flex';
      document.getElementById('chat-screen').style.display = 'none';
    }
  });

  function startChat() {
    const q = query(chatRef, limitToLast(50));
    onChildAdded(q, (snap) => {
      const data = snap.val();
      const messagesDiv = document.getElementById('messages');
      const isMe = currentUser && data.uid === currentUser.uid;

      const row = document.createElement('div');
      row.className = `msg-row ${isMe ? 'me' : ''}`;

      const avatar = document.createElement('img');
      avatar.className = 'mini-avatar';
      avatar.src = data.photo || 'https://via.placeholder.com/30';

      const bubble = document.createElement('div');
      bubble.className = 'bubble';
      
      const sender = document.createElement('span');
      sender.className = 'sender-tag';
      sender.textContent = isMe ? 'YOU' : data.sender.split(' ')[0];

      const text = document.createElement('span');
      text.textContent = data.text;

      bubble.appendChild(sender);
      bubble.appendChild(text);
      row.appendChild(avatar);
      row.appendChild(bubble);
      messagesDiv.appendChild(row);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });
  }

  const send = () => {
    const input = document.getElementById('msgInput');
    if (input.value.trim() && currentUser) {
      push(chatRef, {
        text: input.value,
        sender: currentUser.displayName,
        photo: currentUser.photoURL, // Simpan foto ke database
        uid: currentUser.uid,
        timestamp: serverTimestamp()
      });
      input.value = '';
    }
  };

  document.getElementById('sendBtn').onclick = send;
  document.getElementById('msgInput').onkeypress = (e) => { if (e.key === 'Enter') send(); };
</script>
</body>
</html>
